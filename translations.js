// Multilingual Support - All UI text translations with enhanced features
const TRANSLATIONS = {
  en: {
    // Main Menu
    gameTitle: "Butterfly Flight",
    play: "Play",
    shop: "Shop",
    dailyChallenge: "Daily Challenge",
    settings: "Settings",
    highScore: "High Score",
    totalCoins: "Total Coins",

    // Game UI
    score: "Score",
    tap: "TAP",
    paused: "Game Paused",
    resume: "Resume",
    restart: "Restart",
    mainMenu: "Main Menu",

    // Game Over
    gameOver: "Game Over",
    finalScore: "Final Score",
    coinsEarned: "Coins Earned",
    newHighScore: "New High Score!",
    retry: "Retry",
    changeTheme: "Change Theme",

    // Shop
    skins: "Skins",
    themes: "Themes",
    owned: "Owned",
    equipped: "Equipped",
    buy: "Buy",
    notEnoughCoins: "Not enough coins!",

    // Settings
    audio: "Audio",
    music: "Music",
    soundEffects: "Sound Effects",
    display: "Display",
    theme: "Theme",
    language: "Language",

    // Themes
    pastelClouds: "Pastel Clouds",
    neonCyberpunk: "Neon Cyberpunk",
    egyptianDusk: "Egyptian Dusk",
    watercolorForest: "Watercolor Forest",

    // Daily Challenge
    challengeDesc: "Complete today's challenge to earn bonus coins!",
    reward: "Reward",
    startChallenge: "Start Challenge",
    challengeComplete: "Challenge Complete!",

    // Loading
    loading: "Loading...",

    // Power-ups
    shield: "Shield",
    slowTime: "Slow Time",
    doubleScore: "Double Score",
    magnet: "Magnet",
  },

  ar: {
    // Main Menu
    gameTitle: "طيران الفراشة",
    play: "العب",
    shop: "المتجر",
    dailyChallenge: "التحدي اليومي",
    settings: "الإعدادات",
    highScore: "أعلى نتيجة",
    totalCoins: "إجمالي العملات",

    // Game UI
    score: "النتيجة",
    tap: "اضغط",
    paused: "اللعبة متوقفة",
    resume: "استكمال",
    restart: "إعادة البدء",
    mainMenu: "القائمة الرئيسية",

    // Game Over
    gameOver: "انتهت اللعبة",
    finalScore: "النتيجة النهائية",
    coinsEarned: "العملات المكتسبة",
    newHighScore: "رقم قياسي جديد!",
    retry: "إعادة المحاولة",
    changeTheme: "تغيير الموضوع",

    // Shop
    skins: "الأشكال",
    themes: "المواضيع",
    owned: "مملوك",
    equipped: "مجهز",
    buy: "شراء",
    notEnoughCoins: "عملات غير كافية!",

    // Settings
    audio: "الصوت",
    music: "الموسيقى",
    soundEffects: "المؤثرات الصوتية",
    display: "العرض",
    theme: "الموضوع",
    language: "اللغة",

    // Themes
    pastelClouds: "غيوم الباستيل",
    neonCyberpunk: "نيون سايبربانك",
    egyptianDusk: "غروب مصري",
    watercolorForest: "غابة مائية",

    // Daily Challenge
    challengeDesc: "أكمل تحدي اليوم لكسب عملات إضافية!",
    reward: "المكافأة",
    startChallenge: "بدء التحدي",
    challengeComplete: "تم إكمال التحدي!",

    // Loading
    loading: "جاري التحميل...",

    // Power-ups
    shield: "درع",
    slowTime: "إبطاء الوقت",
    doubleScore: "نقاط مضاعفة",
    magnet: "مغناطيس",
  },

  fr: {
    // Main Menu
    gameTitle: "Vol de Papillon",
    play: "Jouer",
    shop: "Boutique",
    dailyChallenge: "Défi Quotidien",
    settings: "Paramètres",
    highScore: "Meilleur Score",
    totalCoins: "Total des Pièces",

    // Game UI
    score: "Score",
    tap: "TOUCHER",
    paused: "Jeu en Pause",
    resume: "Reprendre",
    restart: "Recommencer",
    mainMenu: "Menu Principal",

    // Game Over
    gameOver: "Fin de Partie",
    finalScore: "Score Final",
    coinsEarned: "Pièces Gagnées",
    newHighScore: "Nouveau Record!",
    retry: "Réessayer",
    changeTheme: "Changer de Thème",

    // Shop
    skins: "Apparences",
    themes: "Thèmes",
    owned: "Possédé",
    equipped: "Équipé",
    buy: "Acheter",
    notEnoughCoins: "Pas assez de pièces!",

    // Settings
    audio: "Audio",
    music: "Musique",
    soundEffects: "Effets Sonores",
    display: "Affichage",
    theme: "Thème",
    language: "Langue",

    // Themes
    pastelClouds: "Nuages Pastel",
    neonCyberpunk: "Néon Cyberpunk",
    egyptianDusk: "Crépuscule Égyptien",
    watercolorForest: "Forêt Aquarelle",

    // Daily Challenge
    challengeDesc: "Complétez le défi d'aujourd'hui pour gagner des pièces bonus!",
    reward: "Récompense",
    startChallenge: "Commencer le Défi",
    challengeComplete: "Défi Terminé!",

    // Loading
    loading: "Chargement...",

    // Power-ups
    shield: "Bouclier",
    slowTime: "Ralentir le Temps",
    doubleScore: "Score Double",
    magnet: "Aimant",
  },

  es: {
    // Main Menu
    gameTitle: "Vuelo de Mariposa",
    play: "Jugar",
    shop: "Tienda",
    dailyChallenge: "Desafío Diario",
    settings: "Configuración",
    highScore: "Puntuación Máxima",
    totalCoins: "Monedas Totales",

    // Game UI
    score: "Puntuación",
    tap: "TOCAR",
    paused: "Juego Pausado",
    resume: "Reanudar",
    restart: "Reiniciar",
    mainMenu: "Menú Principal",

    // Game Over
    gameOver: "Fin del Juego",
    finalScore: "Puntuación Final",
    coinsEarned: "Monedas Ganadas",
    newHighScore: "¡Nueva Puntuación Máxima!",
    retry: "Reintentar",
    changeTheme: "Cambiar Tema",

    // Shop
    skins: "Aspectos",
    themes: "Temas",
    owned: "Poseído",
    equipped: "Equipado",
    buy: "Comprar",
    notEnoughCoins: "¡No hay suficientes monedas!",

    // Settings
    audio: "Audio",
    music: "Música",
    soundEffects: "Efectos de Sonido",
    display: "Pantalla",
    theme: "Tema",
    language: "Idioma",

    // Themes
    pastelClouds: "Nubes Pastel",
    neonCyberpunk: "Neón Cyberpunk",
    egyptianDusk: "Atardecer Egipcio",
    watercolorForest: "Bosque Acuarela",

    // Daily Challenge
    challengeDesc: "¡Completa el desafío de hoy para ganar monedas extra!",
    reward: "Recompensa",
    startChallenge: "Comenzar Desafío",
    challengeComplete: "¡Desafío Completado!",

    // Loading
    loading: "Cargando...",

    // Power-ups
    shield: "Escudo",
    slowTime: "Tiempo Lento",
    doubleScore: "Puntuación Doble",
    magnet: "Imán",
  },

  de: {
    // Main Menu
    gameTitle: "Schmetterlingsflug",
    play: "Spielen",
    shop: "Shop",
    dailyChallenge: "Tägliche Herausforderung",
    settings: "Einstellungen",
    highScore: "Höchstpunktzahl",
    totalCoins: "Gesamte Münzen",

    // Game UI
    score: "Punktzahl",
    tap: "TIPPEN",
    paused: "Spiel Pausiert",
    resume: "Fortsetzen",
    restart: "Neustart",
    mainMenu: "Hauptmenü",

    // Game Over
    gameOver: "Spiel Vorbei",
    finalScore: "Endpunktzahl",
    coinsEarned: "Verdiente Münzen",
    newHighScore: "Neue Höchstpunktzahl!",
    retry: "Wiederholen",
    changeTheme: "Thema Ändern",

    // Shop
    skins: "Skins",
    themes: "Themen",
    owned: "Besessen",
    equipped: "Ausgerüstet",
    buy: "Kaufen",
    notEnoughCoins: "Nicht genug Münzen!",

    // Settings
    audio: "Audio",
    music: "Musik",
    soundEffects: "Soundeffekte",
    display: "Anzeige",
    theme: "Thema",
    language: "Sprache",

    // Themes
    pastelClouds: "Pastell Wolken",
    neonCyberpunk: "Neon Cyberpunk",
    egyptianDusk: "Ägyptische Dämmerung",
    watercolorForest: "Aquarell Wald",

    // Daily Challenge
    challengeDesc: "Vervollständige die heutige Herausforderung, um Bonus-Münzen zu verdienen!",
    reward: "Belohnung",
    startChallenge: "Herausforderung Starten",
    challengeComplete: "Herausforderung Abgeschlossen!",

    // Loading
    loading: "Laden...",

    // Power-ups
    shield: "Schild",
    slowTime: "Zeit Verlangsamen",
    doubleScore: "Doppelte Punkte",
    magnet: "Magnet",
  },

  it: {
    // Main Menu
    gameTitle: "Volo di Farfalla",
    play: "Gioca",
    shop: "Negozio",
    dailyChallenge: "Sfida Giornaliera",
    settings: "Impostazioni",
    highScore: "Punteggio Massimo",
    totalCoins: "Monete Totali",

    // Game UI
    score: "Punteggio",
    tap: "TOCCA",
    paused: "Gioco in Pausa",
    resume: "Riprendi",
    restart: "Ricomincia",
    mainMenu: "Menu Principale",

    // Game Over
    gameOver: "Fine Gioco",
    finalScore: "Punteggio Finale",
    coinsEarned: "Monete Guadagnate",
    newHighScore: "Nuovo Record!",
    retry: "Riprova",
    changeTheme: "Cambia Tema",

    // Shop
    skins: "Skin",
    themes: "Temi",
    owned: "Posseduto",
    equipped: "Equipaggiato",
    buy: "Compra",
    notEnoughCoins: "Monete insufficienti!",

    // Settings
    audio: "Audio",
    music: "Musica",
    soundEffects: "Effetti Sonori",
    display: "Display",
    theme: "Tema",
    language: "Lingua",

    // Themes
    pastelClouds: "Nuvole Pastello",
    neonCyberpunk: "Neon Cyberpunk",
    egyptianDusk: "Tramonto Egiziano",
    watercolorForest: "Foresta Acquerello",

    // Daily Challenge
    challengeDesc: "Completa la sfida di oggi per guadagnare monete bonus!",
    reward: "Ricompensa",
    startChallenge: "Inizia Sfida",
    challengeComplete: "Sfida Completata!",

    // Loading
    loading: "Caricamento...",

    // Power-ups
    shield: "Scudo",
    slowTime: "Rallenta Tempo",
    doubleScore: "Punteggio Doppio",
    magnet: "Magnete",
  },

  pt: {
    // Main Menu
    gameTitle: "Voo da Borboleta",
    play: "Jogar",
    shop: "Loja",
    dailyChallenge: "Desafio Diário",
    settings: "Configurações",
    highScore: "Pontuação Máxima",
    totalCoins: "Moedas Totais",

    // Game UI
    score: "Pontuação",
    tap: "TOCAR",
    paused: "Jogo Pausado",
    resume: "Continuar",
    restart: "Reiniciar",
    mainMenu: "Menu Principal",

    // Game Over
    gameOver: "Fim de Jogo",
    finalScore: "Pontuação Final",
    coinsEarned: "Moedas Ganhas",
    newHighScore: "Nova Pontuação Máxima!",
    retry: "Tentar Novamente",
    changeTheme: "Mudar Tema",

    // Shop
    skins: "Skins",
    themes: "Temas",
    owned: "Possuído",
    equipped: "Equipado",
    buy: "Comprar",
    notEnoughCoins: "Moedas insuficientes!",

    // Settings
    audio: "Áudio",
    music: "Música",
    soundEffects: "Efeitos Sonoros",
    display: "Exibição",
    theme: "Tema",
    language: "Idioma",

    // Themes
    pastelClouds: "Nuvens Pastel",
    neonCyberpunk: "Neon Cyberpunk",
    egyptianDusk: "Crepúsculo Egípcio",
    watercolorForest: "Floresta Aquarela",

    // Daily Challenge
    challengeDesc: "Complete o desafio de hoje para ganhar moedas bônus!",
    reward: "Recompensa",
    startChallenge: "Iniciar Desafio",
    challengeComplete: "Desafio Completado!",

    // Loading
    loading: "Carregando...",

    // Power-ups
    shield: "Escudo",
    slowTime: "Tempo Lento",
    doubleScore: "Pontuação Dupla",
    magnet: "Ímã",
  },

  ru: {
    // Main Menu
    gameTitle: "Полёт Бабочки",
    play: "Играть",
    shop: "Магазин",
    dailyChallenge: "Ежедневный Вызов",
    settings: "Настройки",
    highScore: "Лучший Счёт",
    totalCoins: "Всего Монет",

    // Game UI
    score: "Счёт",
    tap: "НАЖАТЬ",
    paused: "Игра на Паузе",
    resume: "Продолжить",
    restart: "Перезапуск",
    mainMenu: "Главное Меню",

    // Game Over
    gameOver: "Игра Окончена",
    finalScore: "Финальный Счёт",
    coinsEarned: "Заработано Монет",
    newHighScore: "Новый Рекорд!",
    retry: "Повторить",
    changeTheme: "Сменить Тему",

    // Shop
    skins: "Скины",
    themes: "Темы",
    owned: "Владеете",
    equipped: "Экипировано",
    buy: "Купить",
    notEnoughCoins: "Недостаточно монет!",

    // Settings
    audio: "Аудио",
    music: "Музыка",
    soundEffects: "Звуковые Эффекты",
    display: "Дисплей",
    theme: "Тема",
    language: "Язык",

    // Themes
    pastelClouds: "Пастельные Облака",
    neonCyberpunk: "Неон Киберпанк",
    egyptianDusk: "Египетские Сумерки",
    watercolorForest: "Акварельный Лес",

    // Daily Challenge
    challengeDesc: "Выполните сегодняшний вызов, чтобы заработать бонусные монеты!",
    reward: "Награда",
    startChallenge: "Начать Вызов",
    challengeComplete: "Вызов Выполнен!",

    // Loading
    loading: "Загрузка...",

    // Power-ups
    shield: "Щит",
    slowTime: "Замедление Времени",
    doubleScore: "Двойные Очки",
    magnet: "Магнит",
  },

  ja: {
    // Main Menu
    gameTitle: "バタフライフライト",
    play: "プレイ",
    shop: "ショップ",
    dailyChallenge: "デイリーチャレンジ",
    settings: "設定",
    highScore: "ハイスコア",
    totalCoins: "総コイン数",

    // Game UI
    score: "スコア",
    tap: "タップ",
    paused: "ゲーム一時停止",
    resume: "再開",
    restart: "リスタート",
    mainMenu: "メインメニュー",

    // Game Over
    gameOver: "ゲームオーバー",
    finalScore: "最終スコア",
    coinsEarned: "獲得コイン",
    newHighScore: "新記録！",
    retry: "リトライ",
    changeTheme: "テーマ変更",

    // Shop
    skins: "スキン",
    themes: "テーマ",
    owned: "所有済み",
    equipped: "装備中",
    buy: "購入",
    notEnoughCoins: "コインが足りません！",

    // Settings
    audio: "オーディオ",
    music: "音楽",
    soundEffects: "効果音",
    display: "ディスプレイ",
    theme: "テーマ",
    language: "言語",

    // Themes
    pastelClouds: "パステル雲",
    neonCyberpunk: "ネオンサイバーパンク",
    egyptianDusk: "エジプトの夕暮れ",
    watercolorForest: "水彩の森",

    // Daily Challenge
    challengeDesc: "今日のチャレンジをクリアしてボーナスコインを獲得しよう！",
    reward: "報酬",
    startChallenge: "チャレンジ開始",
    challengeComplete: "チャレンジ完了！",

    // Loading
    loading: "読み込み中...",

    // Power-ups
    shield: "シールド",
    slowTime: "スローモーション",
    doubleScore: "ダブルスコア",
    magnet: "マグネット",
  },

  zh: {
    // Main Menu
    gameTitle: "蝴蝶飞行",
    play: "开始游戏",
    shop: "商店",
    dailyChallenge: "每日挑战",
    settings: "设置",
    highScore: "最高分",
    totalCoins: "总金币",

    // Game UI
    score: "分数",
    tap: "点击",
    paused: "游戏暂停",
    resume: "继续",
    restart: "重新开始",
    mainMenu: "主菜单",

    // Game Over
    gameOver: "游戏结束",
    finalScore: "最终分数",
    coinsEarned: "获得金币",
    newHighScore: "新纪录！",
    retry: "重试",
    changeTheme: "更换主题",

    // Shop
    skins: "皮肤",
    themes: "主题",
    owned: "已拥有",
    equipped: "已装备",
    buy: "购买",
    notEnoughCoins: "金币不足！",

    // Settings
    audio: "音频",
    music: "音乐",
    soundEffects: "音效",
    display: "显示",
    theme: "主题",
    language: "语言",

    // Themes
    pastelClouds: "粉彩云朵",
    neonCyberpunk: "霓虹赛博朋克",
    egyptianDusk: "埃及黄昏",
    watercolorForest: "水彩森林",

    // Daily Challenge
    challengeDesc: "完成今日挑战获得奖励金币！",
    reward: "奖励",
    startChallenge: "开始挑战",
    challengeComplete: "挑战完成！",

    // Loading
    loading: "加载中...",

    // Power-ups
    shield: "护盾",
    slowTime: "时间减缓",
    doubleScore: "双倍分数",
    magnet: "磁铁",
  },
}

// Language configuration and utilities
const LANGUAGE_CONFIG = {
  en: { name: "English", dir: "ltr", flag: "🇺🇸" },
  ar: { name: "العربية", dir: "rtl", flag: "🇸🇦" },
  fr: { name: "Français", dir: "ltr", flag: "🇫🇷" },
  es: { name: "Español", dir: "ltr", flag: "🇪🇸" },
  de: { name: "Deutsch", dir: "ltr", flag: "🇩🇪" },
  it: { name: "Italiano", dir: "ltr", flag: "🇮🇹" },
  pt: { name: "Português", dir: "ltr", flag: "🇵🇹" },
  ru: { name: "Русский", dir: "ltr", flag: "🇷🇺" },
  ja: { name: "日本語", dir: "ltr", flag: "🇯🇵" },
  zh: { name: "中文", dir: "ltr", flag: "🇨🇳" },
}

// Translation utility class
class TranslationManager {
  constructor() {
    this.currentLanguage = this.detectBrowserLanguage()
    this.observers = []
    this.init()
  }

  init() {
    // Load saved language preference
    const savedLanguage = localStorage.getItem("butterfly-flight-language")
    if (savedLanguage && TRANSLATIONS[savedLanguage]) {
      this.currentLanguage = savedLanguage
    }

    // Apply initial language
    this.applyLanguage(this.currentLanguage)
  }

  detectBrowserLanguage() {
    const browserLang = navigator.language || navigator.userLanguage
    const langCode = browserLang.split("-")[0].toLowerCase()

    // Check if we support this language
    if (TRANSLATIONS[langCode]) {
      return langCode
    }

    // Fallback to English
    return "en"
  }

  setLanguage(languageCode) {
    if (!TRANSLATIONS[languageCode]) {
      console.warn(`Language ${languageCode} not supported`)
      return false
    }

    this.currentLanguage = languageCode
    localStorage.setItem("butterfly-flight-language", languageCode)
    this.applyLanguage(languageCode)
    this.notifyObservers()
    return true
  }

  applyLanguage(languageCode) {
    const config = LANGUAGE_CONFIG[languageCode]

    // Set document direction
    document.documentElement.dir = config.dir
    document.documentElement.lang = languageCode

    // Add/remove RTL class
    if (config.dir === "rtl") {
      document.body.classList.add("rtl")
    } else {
      document.body.classList.remove("rtl")
    }

    // Update all translatable elements
    this.updateTranslatableElements()
  }

  updateTranslatableElements() {
    const elements = document.querySelectorAll("[data-translate]")
    elements.forEach((element) => {
      const key = element.getAttribute("data-translate")
      const translation = this.get(key)

      if (translation) {
        if (element.tagName === "INPUT" && element.type === "button") {
          element.value = translation
        } else if (element.tagName === "INPUT" && element.placeholder !== undefined) {
          element.placeholder = translation
        } else {
          element.textContent = translation
        }
      }
    })
  }

  get(key, fallback = key) {
    const translations = TRANSLATIONS[this.currentLanguage]
    return translations && translations[key] ? translations[key] : fallback
  }

  getCurrentLanguage() {
    return this.currentLanguage
  }

  getCurrentLanguageConfig() {
    return LANGUAGE_CONFIG[this.currentLanguage]
  }

  isRTL() {
    return LANGUAGE_CONFIG[this.currentLanguage].dir === "rtl"
  }

  addObserver(callback) {
    this.observers.push(callback)
  }

  removeObserver(callback) {
    this.observers = this.observers.filter((obs) => obs !== callback)
  }

  notifyObservers() {
    this.observers.forEach((callback) => callback(this.currentLanguage))
  }

  // Format numbers according to language locale
  formatNumber(number) {
    try {
      return new Intl.NumberFormat(this.currentLanguage).format(number)
    } catch (e) {
      return number.toString()
    }
  }

  // Format currency/coins according to language
  formatCoins(amount) {
    const formatted = this.formatNumber(amount)
    return `${formatted} 🪙`
  }

  // Get all available languages for settings
  getAvailableLanguages() {
    return Object.keys(LANGUAGE_CONFIG).map((code) => ({
      code,
      name: LANGUAGE_CONFIG[code].name,
      flag: LANGUAGE_CONFIG[code].flag,
      dir: LANGUAGE_CONFIG[code].dir,
    }))
  }
}

// Create global translation manager instance
const translationManager = new TranslationManager()

// Convenience function for getting translations
function t(key, fallback = key) {
  return translationManager.get(key, fallback)
}

// Export for use in other files
if (typeof module !== "undefined" && module.exports) {
  module.exports = { TRANSLATIONS, LANGUAGE_CONFIG, TranslationManager, translationManager, t }
}
